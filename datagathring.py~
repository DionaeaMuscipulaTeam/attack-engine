#!/usr/bin/python
import requests
import subprocess
from subprocess import call
import os


def getData(url):
	response = requests.get("https://www.whois.com/whois/"+url)
	bruteData=response.content
	indicedebut=bruteData.index('<pre class="df-raw" id="registrarData">')
	indicedebut+=39
	indicefin=bruteData.index("For more information on Whois status codes, please visit")
	data= bruteData[indicedebut:indicefin]
	print data
	return data

def saveData(data):
	subprocess.call("sudo touch ~/attack-engine1/outputFiles/dataGathring.txt", shell=True)
	path = os.path.join(os.path.expanduser('~'), 'attack-engine1', 'outputFiles', 'dataGathring.txt')
	f = open(path,"w") #opens file with name of "test.txt"
	f.write(data)
	print "data gathred has been saved succefuly \n"
	return 0

def nslookup(url):

	if 'http://' in url :
		url = url.replace('http://','')
	if 'https://' in url :	
		url = url.replace('https://','')

	subprocess.call("sudo touch ~/attack-engine1/outputFiles/serverGathring.txt", shell=True)
	path = os.path.join(os.path.expanduser('~'), 'attack-engine1', 'outputFiles', 'serverGathring.txt')
	f = open(path,"w") #opens file with name of "test.txt"
	process = subprocess.Popen(["nslookup","-type=mx",url], stdout=subprocess.PIPE)
	Result=''
	output = process.communicate()[0].split('\n')
	for list in output :
		if list.find('127.0')==-1:
			Result+=list+'\n'
	process = subprocess.Popen(["nslookup","-type=any",url], stdout=subprocess.PIPE)
	output = process.communicate()[0].split('\n')
	for list in output :
		if list.find('127.0')==-1:
			Result+=list+'\n'		
	print "the result of the nslookup is"+Result
	f.write(Result)
	f.close
	


	"""canname_arr = []
	ip_arr = []
	mailex_arr = []
	for data in output:
		if 'canonical name' in data:
			canname_arr.append(data.replace('canonical name = ',''))
		if 'mail exchanger = ' in data:
			mailex_arr.append(data.replace('mail exchanger = ',''))
	process = subprocess.Popen(["nslookup","-type=nx",url], stdout=subprocess.PIPE)
	output = process.communicate()[0].split('\n')
	for data in output:
		if 'Address' in data:
			ip_arr.append(data.replace('Address: ',''))
	ip_arr.pop(0)

	canname_str=str(canname_arr)
	for list in canname_arr:
		print list
	resCanname=canname_str[2:(len(canname_str) /2 + 1)]
	lenRes=len(resCanname)
	print resCanname
	f.write(resCanname)
	ip=str(ip_arr)
	print ip
	f.write(ip)
	for list in mailex_arr :
		list=list[lenRes-4:len(list)]	
		print list
		f.write(list)"""
	return Result
